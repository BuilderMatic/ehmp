define(["backbone","marionette","underscore","moment","app/applets/documents/debugFlag","app/applets/documents/appletHelper","app/applets/documents/docDetailsDisplayer","app/applets/documents/detail/overviewDetailView","app/applets/documents/detailCommunicator","app/applets/reports/collectionHandler","hbs!app/applets/documents/detail/detailWrapperTemplate"],function(e,t,i,o,n,a,l,r,s,d,p){var c,u=n.flag,h=n.serverDateFilter,g=n.GroupByView,f=null,m=[{name:"dateDisplay",label:"Date",editable:!1,cell:"string",sortValue:function(e,t){return e.get("referenceDateTime")},groupable:!0,groupableOptions:{primary:!0,innerSort:"referenceDateTime",groupByDate:!0,groupByFunction:function(e){return void 0!==e.model?e.model.get("referenceDateTime").toString().substr(0,6):void 0},groupByRowFormatter:function(e){return o(e,"YYYYMM").format("MMMM YYYY")}},hoverTip:"reports_date"},{name:"localTitle",label:"Description",editable:!1,cell:"string",groupable:!0,groupableOptions:{innerSort:"referenceDateTime"},hoverTip:"reports_description"},{name:"kind",label:"Type",editable:!1,cell:"string",groupable:!0,groupableOptions:{innerSort:"referenceDateTime"},hoverTip:"reports_type"},{name:"authorDisplayName",label:"Author or Verifier",editable:!1,cell:"string",groupable:!0,groupableOptions:{innerSort:"referenceDateTime"},hoverTip:"reports_enteredby"},{name:"facilityMoniker",label:"Facility",editable:!1,cell:"string",groupable:!0,groupableOptions:{innerSort:"referenceDateTime"},hoverTip:"reports_facility"}],b=[m[0],m[2],m[3]],D={filterEnabled:!0,onClickRow:function(e,t){var i,o=e.get("kind"),n=e.get("complexDoc");if(n&&(i=a.getResultsFromUid(e)),$("#center").hasClass("col-md-12")){var l=$(t.target).closest("tr"),r=l.offset().top;$("#center").find(".data-grid").removeClass("col-md-12"),$("#center").find(".data-grid").addClass("col-md-6"),0===$("#doc-detail-region").length?($("#center").find(".grid-container div:first-child").append(p({})),this.parent.addRegion("docDetail","#doc-detail-region")):$("#doc-detail-wrapper").removeClass("hide"),void 0!==this.parent&&(this.parent.hiddenColumns=!0,this.parent.changeView(e,o,i));var s=l.closest(".data-grid").scrollTop(),d=l.offset().top,c=d-r,u=s+c;l.closest(".data-grid").scrollTop(u),f=$(":focus"),$(".docDetailTitle").focus()}else void 0!==this.parent&&this.parent.changeModelView(e,o,i)}},w={},T=ADK.Applets.BaseGridApplet,y=T.extend({className:"reportApp",lastTypeClicked:"unk",hiddenColumns:!1,events:function(){return i.extend({},T.prototype.events,{"click .hideDetail":"hideDetail"})},showGridView:function(){this.refreshGrid(!1)},groupByView:function(){this.refreshGrid(!0)},initialize:function(e){u&&console.log("Doc Tab App -----> init start"),c=this.options=e,this.options.groupView=g,w=T.prototype,D.parent=this;var t=this;D.summaryColumns=b,D.fullScreenColumns=m,D.collection=ADK.PatientRecordService.createEmptyCollection(),D.appletConfig=e.appletConfig,D.groupable=this.options.groupView,this.listenTo(d,"resetCollection",function(e){t.dataGridOptions.collection.url=e.url,t.dataGridOptions.collection.fetchOptions=e.fetchOptions,t.dataGridOptions.collection.reset(e.models),t.dataGridOptions.collection.originalModels=t.dataGridOptions.collection.models,this.onSync()}),this.listenTo(ADK.Messaging,"globalDate:selected",function(e){u&&console.log("Doc Tab date filter range----->"+JSON.stringify(e)),h?(t.hideDetail(),u&&console.log("Doc Tab server side filter refresh"),t.fetchData()):(a.globalFilterStatus(e)?a.hideAppFilter():a.showAppFilter(),t.hideDetail(),u&&console.log("Doc Tab client side filter refresh"),d.queryCollection(e.attributes.fromDate,e.attributes.toDate))},this),this.dataGridOptions=D,w.initialize.apply(this,arguments)},refreshGrid:function(e){u&&console.log("Doc Tab App -----> refreshGrid"),this.showLoading(),this.options.groupView=e,this.initialize(this.options)},onRender:function(){u&&console.log("Doc Tab App -----> onRender"),w.onRender.apply(this,arguments)},onShow:function(){u&&console.log("Doc Tab App -----> onShow"),g||(0===$("#gridView-documents").length&&$("#center").find(".grid-filter-button").before('<button id="gridView-documents" class="btn btn-sm btn-link" title="Grid View"><span  class="gridView applet-title-button fa fa-th" ><span class="sr-only">Grid View</span></span></button>'),0===$("#groupByView-documents").length&&$("#center").find(".grid-filter-button").before('<button id="groupByView-documents" class="btn btn-sm btn-link" title="Group by View"><span class="groupByView applet-title-button fa fa-th-list" ><span class="sr-only">Group by View</span></span></button>')),this.fetchData(),w.onShow.apply(this,arguments)},fetchData:function(){d.queryCollection(this)},changeView:function(e,t,i){if(u&&console.log("Doc Tab App -----> changeView"),this.lastTypeClicked===t)this.updateDetailView(e),this.updateDetailTitle(l.getTitle(e,t));else{var o=l.getView(e,t,i),n=this;o.done(function(i){n.docDetail.show(i.view),n.updateDetailTitle(i.title||l.getTitle(e,t))})}this.$("#doc-detail-wrapper").scrollTop(0)},changeModelView:function(e,t,i){u&&console.log("Doc Tab App -----> changeView");var o=l.getView(e,t,i);o.done(function(i){var o={title:i.title||l.getTitle(e,t),size:"large"},n=new ADK.UI.Modal({view:i.view,options:o});n.show(),$("#mainModal").modal("show")})},updateDetailTitle:function(e){$("#doc_detail_top .docDetailTitle").html(e)},updateDetailView:function(e){u&&console.log("Doc Tab App -----> updateDetailView"),this.docDetailView.model=e,this.docDetailView.render()},hideColumns:function(){u&&console.log("Doc Tab App -----> hideColumns"),this.hiddenColumns===!0&&($("#data-grid-documents tr *:nth-child(4)").addClass("hide"),$("#data-grid-documents tr *:nth-child(5)").addClass("hide"))},hideDetail:function(){u&&console.log("Doc Tab App -----> hideDetail"),$("#doc-detail-wrapper").addClass("hide"),$("#center").find(".data-grid").removeClass("col-md-6"),$("#center").find(".data-grid").addClass("col-md-12"),this.hiddenColumns=!1,f&&f.focus()}}),v={id:"reports",viewTypes:[{type:"summary",view:y,chromeEnabled:!0}],defaultViewType:"summary"};return s.initialize(v.id),v});